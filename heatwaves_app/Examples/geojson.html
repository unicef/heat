<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />

    <!-- Styles for the map and UI elements -->
    <style>
        #map {
            position: relative;
            /* Add this to enable absolute positioning inside */
            height: 600px;
            width: 100%;
        }
    </style>
</head>

<body>
    <!-- Website title -->
    <h1>Children Exposure to Heatwaves</h1>

    <!-- Control panel for selecting sub-indicator and threshold-->
    <div id="controls">
        <label for="sub-indicator">Select sub-indicator:</label>
        <select id="sub-indicator">
            <option value="Heatwave Frequency">Frequency</option>
            <option value="Heatwave Duration">Duration</option>
            <option value="Heatwave Severity">Severity</option>
            <option value="Extreme Heat Days">Extreme High Temp.</option>
        </select>

        <label for="percentage">Select percentage increase:</label>
        <select id="percentage">
            <option value="50%">50%</option>
            <option value="100%">100%</option>
            <option value="200%">200%</option>
        </select>
    </div>

    <!-- define map container -->
    <div id="map"></div>

    <!-- import necessary libraries -->
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/chroma-js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>

    <script>
        // initalize leaflet map
        var map = L.map('map').setView([40, 0], 2);

        // add OpenStreetMap basemap
        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            noWrap: true,
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var geojsonLayer;

        function updateMap(subIndicator, percentage) {
            if (geojsonLayer) {
                map.removeLayer(geojsonLayer);
            }

            // Load the GeoJSON file
            fetch('../../input/child_population_geojson.geojson')
                .then(response => response.json())
                .then(data => {
                    // Add the GeoJSON layer to the map
                    geojsonLayer = L.geoJson(data, {
                        onEachFeature: function (feature, layer) {
                            var countryName = feature.properties['Country Name'];
                            var value = feature.properties[subIndicator + " Increased by " + percentage];

                            // Create popup content
                            var popupContent = "Country: " + countryName + "<br>" + subIndicator + " Increased by " + percentage + ": " + value;
                            layer.bindPopup(popupContent);
                        }
                    }).addTo(map);
                })
                .catch(error => {
                    console.error('Error loading the GeoJSON file:', error);
                });
        }

        // Event listeners for the filters
        document.getElementById('sub-indicator').addEventListener('change', function () {
            var subIndicator = document.getElementById('sub-indicator').value;
            var percentage = document.getElementById('percentage').value;
            updateMap(subIndicator, percentage);
        });

        document.getElementById('percentage').addEventListener('change', function () {
            var subIndicator = document.getElementById('sub-indicator').value;
            var percentage = document.getElementById('percentage').value;
            updateMap(subIndicator, percentage);
        });

        // Initial map update
        updateMap('Heatwave Frequency', '50%');

    </script>
</body>

</html>