<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/chroma-js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
    <script>
        var map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var url_to_geotiff_file = "https://unicefdownloadfiletest.blob.core.windows.net/prueba/average_hwi_2020s_proj.tif";

        fetch(url_to_geotiff_file)
            .then(response => response.arrayBuffer())
            .then(arrayBuffer => {
                parseGeoraster(arrayBuffer).then(georaster => {
                    const min = georaster.mins[0];
                    const max = georaster.maxs[0];

                    // available color scales can be found by running console.log(chroma.brewer);
                    console.log(chroma.brewer);
                    var scale = chroma.scale('OrRd').domain([min, max]);

                    var layer = new GeoRasterLayer({
                        attribution: "Unicef",
                        georaster: georaster,
                        opacity: 0.7,
                        pixelValuesToColorFn: function (pixelValues) {
                            var pixelValue = pixelValues[1]; // access first band of the raster

                            // Handle non-data values explicitly
                            if (pixelValue === 0 || pixelValue === null || pixelValue === undefined) return null;

                            var color = scale(pixelValue).hex();

                            return color;
                        },
                        resolution: 256
                    });
                    console.log("layer:", layer);
                    layer.addTo(map);

                    map.fitBounds(layer.getBounds());
                });
            });
    </script>
</body>

</html>